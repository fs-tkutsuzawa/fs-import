# Phase7 実装計画（最短ルート・最小差分）

## ゴール再確認

- コアロジックの年次計算結果を `GridPage` に確実に表示する。
- 月次列など追加機能は後工程に回し、必要であれば空表示を許容する。
- 今回触れた範囲の Lint warning を極力減らし、レッド解消を優先する。

## 制約

- 既存 UI 構造を崩さず最小差分で実装する。
- API エラー時は従来通りダミーデータでフォールバックする。
- 月次/調整列のロジックはスコープ外。無理に 12 等分等は行わない。
- warning 全消しは不要だが、今回の変更で増えた warning は可能な範囲で解消する。

## TODO（実装順）

1. **列生成の整理**
   - `GridPage` 側で API 結果表示時は年次カラムのみ生成する（`buildGridFromFinancialData` と列生成の分岐を調整）。
   - 月次/調整列は生成しないか、空値のまま表示。
2. **表示ロジックの分岐調整**
   - `displayRows` が API 使用時に比率行やバランスチェックを追加しないよう条件を整理。
3. **Lint warning ケア**
   - 今回触れたファイルでの `no-non-null-assertion`、未使用変数などを可能な範囲で修正。
   - 解消が難しい warning は TODO コメントや Issue 化で可視化。
4. **テスト整備（必要に応じて）**
   - `GridPage` の API 結果反映を簡易に検証するテストを追加するか検討。
5. **ドキュメント更新**
   - `phase6_completion` ノートとの整合を保ちつつ、残課題と今後の対応方針を追記。

## チェックリスト

- [ ] API 結果表示時に余計な月次カラムが出力されない。
- [ ] ダミーデータ利用時の既存挙動（比率計算など）が崩れていない。
- [ ] `npm run lint` がエラーなし（warning は既知のみ）。
- [ ] `npm test -- useCalculationJob.test.tsx` など関連テストを確認。
- [ ] UI で計算開始 → 結果反映 → クリアの操作が成立する。

## 備考

- 月次展開ロジックや追加指標は別フェーズで検討。
- `FinancialStatementPreview` 等とのロジック共通化は必要性を見極めて後続で対応する。
